<html>
    <head>
        <meta charset="UTF-8">
        <!-- blank favicon to supress extra request-->
        <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQEAYAAABPYyMiAAAABmJLR0T///////8JWPfcAAAACXBIWXMAAABIAAAASABGyWs+AAAAF0lEQVRIx2NgGAWjYBSMglEwCkbBSAcACBAAAeaR9cIAAAAASUVORK5CYII=">
        <script src="js/elementary.js"></script>
        <script src="js/kvetch.js"></script>
        <script src="js/propmodified.js"></script>
        <script src="js/formbinder.js"></script>
        <script src="js/controlpanel.js"></script>
    
        <script src="js/geodesyUtil.js" defer="true"></script>
        <!-- <script src="js/outTurf.js" defer="true"></script> -->

        <script src="templates/geodesyForm.js"></script> <!--returns controlgeodesy function -->
        <script src="templates/motifStyle.js"></script>
        <script src="templates/normData.js"></script>
    </head>
    <body id="body">
        <geodesy
            id="honeycombA"
            motif="honeycomb"
            shells="15"
            radius="100"
            bg-color="#00ff00"
            fg-color="#0000ff"
            backoff="1.05"
        ></geodesy>
        <script>
            // attach listener to geodesy, onclick, toggle active class of event.target.

            // document.body.innerElement = elementary(geodesyFormStyle())

            /*
            for getting a bitmask from a linear function
            create an array of 0s as long as you need
            count up the length, while lastIndex < bitmask.length, 
            
            while(a*x + b < bitmask.length){
                bitmask[a*x + b] = true
                x++
            }
            bitmask.map(Number).map(String).flat
            // eat through the bitmask array 8 elements at a time, converting them to hexadecimal.
            this.props.bitmask = "ff"
            // the bitmask callback then goes over the children and sets them as active or not
            */

            window.cache = {}
            Promise.all([
                kvetch.get(`cache/square.json`).then(res => window.cache.square = res),
                kvetch.get(`cache/pyritohedron.json`).then(res => window.cache.pyritohedron = res),
                kvetch.get(`cache/honeycomb.json`).then(res => window.cache.honeycomb = res),
                kvetch.get(`cache/p4octagon.json`).then(res => window.cache.p4octagon = res)
            ]).then(()=>{

                Array.from(document.querySelectorAll('geodesy'), geodesyElement => {
                    // what to do for each geodesy element already on the page
                    // ideally to save the state of the page, 
                    // just take the list of geodesy elements and get their props
                    // and that should create a file good enough to recreate the page with.

                    // add form to control it...
                    // geodesyCreate(geodesyElement) // create the style element first
                    document.body.appendChild(geodesyControl(geodesyElement))
                })
            })
            // for the attribute change listeners on each geodesy element...
            // registergeodesy will take a newly created geodesy element, and attach attributechanged callbacks
            // some of those callbacks are going to need the style tag controlling the geodesy tag.
            // so create the style tag, create the geodesy, set a reference to styleTag on geodesy...
            // so geodesy can read its own styletag.

        </script>
    </body>
</html>

